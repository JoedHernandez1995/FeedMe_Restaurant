<!DOCTYPE html>
<html>
<head>
  <!--Import jQuery before materialize.js-->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="js/materialize.min.js"></script>
  <!--Import AngularJS -->
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.0/angular.min.js"></script>
  <!--Import Google Icon Font-->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
  <!-- Compiled and minified CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/css/materialize.min.css">
  <!-- Compiled and minified JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.5/js/materialize.min.js"></script>
  <!--Import custom javascript-->
  <script type="text/javascript" src="scripts/script.js"></script>
  <!--Import custom styles-->
  <link type="text/css" rel="stylesheet" href="styles/styles.css"/>
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body background="./images/background.png">

  <nav>
    <div class="nav-wrapper red darken-4">
      <img src="./images/Drawing.png" class="nav_bar_logo_left brand-logo" />
      <h3 class="nav_bar_logo_left brand-logo restaurant_name"></h3>
      <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
      <ul class="right hide-on-med-and-down">
        <li><a href="#" onclick="orders()">Ordenes</a></li>
        <!-- Dropdown Trigger -->
        <li><a href="#" onclick="toFoods()">Ver Menu</a></li>
        <li><a href="#" onclick="addFoods()">Agregar Comida</a></li>
        <li><a href="#" onclick="facturacion()">Facturacion</a></li>
        <li class="active"><a href="#" onclick="factura()">Ver Factura</a></li>
        <li><a href="#" onclick="sugerencias()">Ver Sugerencias</a></li>
        <li><a href="#" onclick="quejas()">Libro de Quejas</a></li>
        <li><a href="home.html">Cerrar Sesion</a></li>
      </ul>
      <ul class="side-nav" id="mobile-demo">
        <li><a class="red-text text-darken-4" href="#" onclick="orders()">Ordenes</a></li>
        <li><a class="red-text text-darken-4" href="#" onclick="toFoods()">Ver Menu</a></li>
        <li><a class="red-text text-darken-4" href="#" onclick="addFood()">Agregar Comida</a></li>
        <li><a class="red-text text-darken-4" href="#" onclick="facturacion()">Facturacion</a></li>
        <li class="active"><a class="red-text text-darken-4" href="#" onclick="factura()">Ver Factura</a></li>
        <li><a class="red-text text-darken-4" href="#" onclick="sugerencias()">Ver Sugerencias</a></li>
        <li><a class="red-text text-darken-4" href="#" onclick="quejas()">Libro de Quejas</a></li>
        <li><a class="red-text text-darken-4" href="#">Cerrar Sesion</a></li>
      </ul>
    </div>
  </nav>

</br>
</br>

<div class="row">
<div class="col s12 m8 push-m2">
  <div class="card-panel white">
    <div class="row">
      <div class="col s8 m8">
        <strong><p id="restaurantName">Nombre de Restaurante: </p></strong>
      </div>
      <div class="col s4 m4" id="cai">
      </div>
    </div>
    <div class="row">
      <div class="col s4 m4 push-s8 push-m8">
        <p id="num_factura">No. Factura:</p>
      </div>
    </div>
    <div class="row">
      <div class="col s8 m8">
        <p id="direccion">Direccion Del Local</p>
      </div>
      <div class="col s4 m4">
        <p id="fecha_emision">Fecha:</p>
      </div>
    </div>
    <div class="row">
      <div class="col s8 m8">
        <p id="rtn">R.T.N:</p>
      </div>
    </div>
    <div class="row">
      <div class="col s8 m8">
        Telefono:
      </div>
    </div>
    <div class="row">
      <div class="col s8 m8">
        <p id="correo">Correo: </p>
      </div>
    </div>
    <div class="row">
      <div class="col s8 m8 push-m1">
        <p id="cliente"> Cliente: </p>
      </div>
      <div class="col s4 m4 pull-m1">
        <p id="rtn_cliente"> R.T.N: </p>
      </div>
    </div>
    <div class="row">
      <table class="bordered striped highlight">
        <thead>
          <tr>
            <th class="center" data-field="cant">Nombre del Producto</th>
            <th class="center" data-field="desc">Precio Unitario</th>
          </tr>
        </thead>

        <tbody id="orderItems">

        </tbody>

      </table>
    </div>

    <div class="row">
      <div class="col s6 m6">
        <strong>Son:</strong>
      </br>
      </br>
        <strong>Fecha Limite Emision: </strong>
      </br>
      </br>
        <strong>Original: </strong>
      </div>
      <div class="col s6 m6">
        <table class="bordered striped">
          <tbody>
            <tr>
              <th>Importe Externo/ISV T </th>
              <td > L. </td>
            </tr>
            <tr>
              <th>Importe ISV </th>
              <td> L. </td>
            </tr>
            <tr>
              <th>ISV 15%</th>
              <td> L. </td>
            </tr>
            <tr>
              <th>TOTAL A PAGAR</th>
              <td id="precio_total"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="row">
      <div class="col s6">
        <strong>Rango Autorizado:</strong>
      </div>
    </div>
    <div class="row">
      <div class="center">
        <strong>"La factura es beneficio de todos, exijala"</strong>
      </div>
    </div>
  </div>
</div>
</div>

</body>
<script type="text/javascript">
/*Parse URL to get Current User Data*/
var ids = [];

function qs() {
    var query = window.location.search.substring(1);
    var parms = query.split('&');
    for (var i=0; i < parms.length; i++) {
        var pos = parms[i].indexOf('=');
        if (pos > 0) {
            var key = parms[i].substring(0, pos);
            var val = parms[i].substring(pos + 1);
        }
        ids.push(val);
    }
}

function toFoods(){
  window.location = "comidasIndex.html?id_usuario="+currentUserID;
}

function addFoods(){
  window.location = "agregarComida.html?id_usuario="+currentUserID;
}

function orders(){
  window.location = "mainPage.html?id_usuario="+currentUserID;
}

function factura(){
  window.location = "factura.html?id_usuario="+currentUserID;
}

function facturacion(){
  window.location = "facturacion.html?id_usuario="+currentUserID;
}

function quejas(){
  window.location = "quejas.html?id_usuario="+currentUserID;
}

function sugerencias(){
  window.location = "sugerencias.html?id_usuario="+currentUserID;
}

function getTodayDate(){
  var tdate = new Date();
  var dd = tdate.getDate();
  var MM = tdate.getMonth();
  var yyyy = tdate.getFullYear();
  var xxx = dd + "-" + (MM+1) + "-" + yyyy;
  return xxx;
}
qs();

var currentUserID = ids[0];

var currentOrderID = ids[1];


$.ajax({
  url: 'https://feedmeserver.herokuapp.com/restaurantes',
  type: 'GET',
  cache: false,
  dataType: "json",
  success: function(restaurantData) {
    $.each(restaurantData, function(key, value){
      if(value.id_usuario == currentUserID){
        $(".restaurant_name").append(value.nom_restaurante);
        $("#restaurantName").append(value.nom_restaurante);
      }
    });
  },
  error: function(e) {
    //called when there is an error
    //console.log(e.message);
  }
});

var data = new Object();
data.restauranteid = currentUserID;


//$.ajax({
//  url: 'https://feedmeserver.herokuapp.com/deiRestaurante',
//  type: 'GET',
//  cache: false,
//  dataType: "json",
//  data: JSON.stringify(data),
//  success: function(deiData) {
//    $.each(deiData, function(key, value){
//      alert(value.restauranteid);
//      $("#restaurantName").append(value.restauranteid);
//      $("#cai").append(value.cai);
//    });
//  },
//  error: function(e) {
//    console.log(e.message);
//  }
//});

var tablerow="";

$.ajax({
  url: 'https://feedmeserver.herokuapp.com/comidas_cliente',
  type: 'GET',
  cache: false,
  dataType: "json",
  success: function(ordersData) {
    $.each(ordersData, function(key, value){
      if(currentOrderID == value.id_orden){
        tablerow = "<tr>";
        tablerow += "<td>"+value.nombre+"</td>";
        tablerow += "<td>"+value.precio+"</td>";
        tablerow += "</tr>";
        $("#orderItems").append(tablerow);
      }
    });
  },
  error: function(e) {
    //called when there is an error
    //console.log(e.message);
  }
});

$.ajax({
  url: 'https://feedmeserver.herokuapp.com/dei',
  type: 'GET',
  cache: false,
  dataType: "json",
  success: function(ordersData) {
    $.each(ordersData, function(key, value){
      if(value.restauranteid == currentUserID){
        $("#rtn").append(value.rtn);
        $("#cai").append("<p>C.A.I: "+value.cai+"</p>");
        $("#correo").append(value.correo);
        $("#num_factura").append(value.num_factura_actual);
        $("#fecha_emision").append(getTodayDate());
      }
    });
  },
  error: function(e) {
    //called when there is an error
    //console.log(e.message);
  }
});

</script>
</html>
